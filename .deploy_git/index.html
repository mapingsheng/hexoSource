<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="soujava, java" />





  <link rel="alternate" href="/atom.xml" title="soujava" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="记录未知的，牢记已知的">
<meta property="og:type" content="website">
<meta property="og:title" content="soujava">
<meta property="og:url" content="http://www.soujava.com/index.html">
<meta property="og:site_name" content="soujava">
<meta property="og:description" content="记录未知的，牢记已知的">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="soujava">
<meta name="twitter:description" content="记录未知的，牢记已知的">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://www.soujava.com/"/>

  <title> soujava </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">soujava</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录未知的，牢记已知的</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/运用webGL实现3D效果-机器组装/" itemprop="url">
                  运用webGL实现3D效果-机器组装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-02-02T16:27:07+08:00" content="2018-02-02">
              2018-02-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/3D/" itemprop="url" rel="index">
                    <span itemprop="name">3D</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在二次元的世界里，如果有些东西能以3D的效果展示，给人的感觉是完全不一样的，比如我们平时使用的地图导航上面显示的3D画面、教学场景中使用的几何教学演示、一些3D场景的动画等等，针对这些应用，完全可以使用webGL实现，并且在浏览器中无障碍展示，并且还可以添加交互功能。</p>
<p><img src="http://soujava.com/images/webgl1.png" alt="Alt text"></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/运用webGL实现3D效果-机器组装/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/DataOutputStream-write方法入坑/" itemprop="url">
                  DataOutputStream.write方法入坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-22T20:47:09+08:00" content="2017-12-22">
              2017-12-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近需要开发一个web端创建管理具有IM功能的群组，具备跟微信一样的聊天功能，是调用第三方服务的接口实现的；所以调用其他同事的公共方法调用第三方的rest接口时，由于需要带着用户的中文名称注册昵称，所以在调用接口过程中，发现了莫名其妙的中文参数乱码问题，让我很是费解，因为在该设置编码的地方都已经全部设置为utf-8；仍然出现中文乱码。下面是我的排查及解决问题过程：</p>
<blockquote>
<p>整个rest接口调用的公共方法代码大致思路如下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">String paramter = <span class="string">"name=张三"</span>;</div><div class="line">   </div><div class="line">   String register_account_url = <span class="string">"https://*.wefs.comg/user/register"</span>;</div><div class="line">URL url = <span class="keyword">new</span> URL(register_account_url);</div><div class="line">URLConnection connection = url.openConnection();</div><div class="line">HttpsURLConnection httpsURLConnection = (HttpsURLConnection)connection;</div><div class="line">httpsURLConnection.setRequestMethod(<span class="string">"POST"</span>);<span class="comment">//设置请求类型</span></div><div class="line">httpsURLConnection.setUseCaches(<span class="keyword">false</span>);</div><div class="line">httpsURLConnection.setDoInput(<span class="keyword">true</span>);</div><div class="line">httpsURLConnection.setDoOutput(<span class="keyword">true</span>);</div><div class="line">httpsURLConnection.setConnectTimeout(<span class="number">30000</span>);<span class="comment">//设置连接超时时间</span></div><div class="line">httpsURLConnection.setReadTimeout(<span class="number">600000</span>);<span class="comment">//设置读取超时时间</span></div><div class="line">httpsURLConnection.setRequestProperty(<span class="string">"Charsert"</span>, <span class="string">"UTF-8"</span>);<span class="comment">//设置编码</span></div><div class="line">httpsURLConnection.setRequestProperty(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded;charset=utf-8"</span>);</div><div class="line">   </div><div class="line">DataOutputStream submitDos = <span class="keyword">new</span> DataOutputStream(httpsURLConnection.getOutputStream());</div><div class="line"></div><div class="line">submitDos.writeBytes(paramter);<span class="comment">//关键的一行代码，这样会出现乱码</span></div></pre></td></tr></table></figure>
<hr>
<ul>
<li><p>整个排查过程很是费解，先排查接受web端的参数中是否乱码，然后排查请求第三方接口时是否设置了编码；然后排查向第三方接口传递参数时是否编码统一等等关键点，排查后依然中文乱码</p>
</li>
<li><p>就定位到了DataOutputStream.writeBytes(paramter);这一行，因为说实在的，关于这个类这个方法还是第一次见到在这样的场景中使用；</p>
</li>
<li><p>然后就进入到writeBytes方法源码中看了一下，果然发现了问题所在，该方法源码如下：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">writeBytes</span><span class="params">(String s)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">       <span class="keyword">int</span> len = s.length();</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; len ; i++) &#123;</div><div class="line">           out.write((<span class="keyword">byte</span>)s.charAt(i));<span class="comment">//关键问题就出现在这一行</span></div><div class="line">       &#125;</div><div class="line">       incCount(len);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>我们在源码中发现了一个在for循环中使用了<em>(byte)s.charAt(i)</em>这一行代码，下面逐行分解如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 我们把上面的for循环中的out.write((byte)s.charAt(i));这一句代码拆开成如下   的for循环语句</div><div class="line"> */</div><div class="line">String s = <span class="string">"张三"</span>；</div><div class="line"><span class="keyword">int</span> len = s.length();<span class="comment">//长度为2</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; len ; i++) &#123;</div><div class="line">	<span class="keyword">char</span> cs = s.charAt(i); <span class="comment">//张 [一个char占2个字节(16位)，所以可以存储大部分的中文]</span></div><div class="line">   	<span class="keyword">byte</span> by = (<span class="keyword">byte</span>)cs; <span class="comment">//问题根源所在 [一个byte占1个字节(8位)，把char强转为byte就会发生丢失]</span></div><div class="line">       out.write(by); <span class="comment">//其实调用的api方法为 write(int b);只不过把byte自动向上转型为int型而已</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>解决问题的办法就是不要使用out.writeBytes(String s)这个方法，更改为out.write(byte b[])这个重载的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//有问题的代码 </span></div><div class="line">submitDos.writeBytes(paramter);</div><div class="line"></div><div class="line"><span class="comment">//更改后的代码</span></div><div class="line">submitDos.write(paramter.getBytes());</div></pre></td></tr></table></figure>
<blockquote>
<p>下面针对DataOutputStream的write方法写一个小demo进行验证</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line"> <span class="comment">/**</span></div><div class="line"> * 声明一个指向D盘下test.txt的输出流(d盘确保已经存在test.txt文件)</div><div class="line"> * </div><div class="line"> * 然后我们把一个中文字符分别通过out.writeBytes(String s)方法和write(byte b[])写入到这个文件中然后我们查看写入到文件中的内容</div><div class="line"> */</div><div class="line">DataOutputStream out = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"D:\\test.txt"</span>));</div><div class="line">String count = <span class="string">"马"</span>;</div><div class="line">out.writeBytes(count);</div></pre></td></tr></table></figure>
<blockquote>
<p>上面代码写入到文件中的内容为 l；即英文的消息l字符；因为我们把”马”这个中文调用out.writeBytes(String s)方法时，由于内部发送了如下转换：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> <span class="keyword">char</span> c= count.charAt(<span class="number">0</span>);</div><div class="line"><span class="keyword">byte</span> b = (<span class="keyword">byte</span>)c;<span class="comment">//把值为马的char型转换为byte型后，值变为108</span></div><div class="line">out.write(c); <span class="comment">//由于108对应的就是小写英文字符l</span></div></pre></td></tr></table></figure>
<p>所以问题根源就是 JAVA中的char是16位的，一个char存储一个中文字符，直接用转换byte强转换后会变为8位，直接导致高8位丢失，从而导致中文乱码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line"> <span class="comment">/**</span></div><div class="line"> * 声明一个指向D盘下test.txt的输出流(d盘确保已经存在test.txt文件)</div><div class="line"> * </div><div class="line"> * 然后我们把一个中文字符分别通过out.writeBytes(String s)方法和write(byte b[])写入到这个文件中然后我们查看写入到文件中的内容</div><div class="line"> */</div><div class="line">DataOutputStream out = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"D:\\test.txt"</span>));</div><div class="line">String count = <span class="string">"马"</span>;</div><div class="line">out.write(count.getBytes()); <span class="comment">//可以正常的把中文字符 马 输出到test.txt文件中</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/使用spring的RestTemplate调用REST接口/" itemprop="url">
                  使用spring的RestTemplate调用REST接口
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-18T18:18:39+08:00" content="2017-12-18">
              2017-12-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发接口调用时，我们后台一般使用spring的RestTemplate调用对应的REST接口获取数据；具体使用如下：</p>
<p>一、RestTemplate源码中的常用API</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">	<span class="comment">// GET</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getForObject</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Object... urlVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; urlVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">getForEntity</span><span class="params">(URI url, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">&gt;</div><div class="line"></div><div class="line">	<span class="comment">// POST</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(URI url, Object request, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span></span></div><div class="line">			<span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(URI url, Object request, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">&gt;</div><div class="line"></div><div class="line">	<span class="comment">// PUT</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Object request, Object... urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Object request, Map&lt;String, ?&gt; urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(URI url, Object request)</span> <span class="keyword">throws</span> RestClientException </span>&#123;&#125;</div><div class="line"></div><div class="line">&gt;</div><div class="line"></div><div class="line">	<span class="comment">// DELETE</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String url, Object... urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</div><div class="line">		execute(url, HttpMethod.DELETE, <span class="keyword">null</span>, <span class="keyword">null</span>, urlVariables);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String url, Map&lt;String, ?&gt; urlVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</div><div class="line">		execute(url, HttpMethod.DELETE, <span class="keyword">null</span>, <span class="keyword">null</span>, urlVariables);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(URI url)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</div><div class="line"></div><div class="line">&gt;</div><div class="line"></div><div class="line">	<span class="comment">// general execution</span></div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(String url, HttpMethod method, RequestCallback requestCallback,</span></span></div><div class="line">			ResponseExtractor&lt;T&gt; responseExtractor, Object... urlVariables) <span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(String url, HttpMethod method, RequestCallback requestCallback,</span></span></div><div class="line">			ResponseExtractor&lt;T&gt; responseExtractor, Map&lt;String, ?&gt; urlVariables) <span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(URI url, HttpMethod method, RequestCallback requestCallback,</span></span></div><div class="line">			ResponseExtractor&lt;T&gt; responseExtractor) <span class="keyword">throws</span> RestClientException &#123;&#125;</div><div class="line"></div><div class="line">&gt;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">     * 以上所有的get、post等等方法底层都是调用的该方法执行的rest接口请求</div><div class="line">     */</div><div class="line">	<span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">doExecute</span><span class="params">(URI url, HttpMethod method, </span></span></div><div class="line">		RequestCallback requestCallback,ResponseExtractor&lt;T&gt; responseExtractor) <span class="keyword">throws</span> RestClientException &#123;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>其实针对上面的GET<em>、POST</em>、DELETE*等等rest接口请求方法中，整个调用底层都是调用的doExecute()方法</p>
</blockquote>
<p><img src="http://soujava.com/images/restTemplate.png" alt="Alt text"></p>
<p>二、<strong>RestTemplate调用接口示例</strong></p>
<blockquote>
<p>1.GET-直接实例化RestTemplate对象并采用GET方法调用对应的rest接口，并返回对应的响应值字符串</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">RestTemplate restClient = <span class="keyword">new</span> RestTemplate();</div><div class="line">String url = <span class="string">"http://localhost:8080/user/info/v5.6.5?id=3f62fca0123"</span>;</div><div class="line">String result = restClient.getForObject(<span class="keyword">new</span> URI(url), String.class);</div></pre></td></tr></table></figure>
<blockquote>
<p>2.GET-调用对应的REST接口，并用响应结果对象示例接收封装对应的结果集</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * rest接口响应值的数据封装类</div><div class="line">    */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseResult</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ResponseResult</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> rlt;</div><div class="line">	<span class="keyword">private</span> String msg;</div><div class="line">	<span class="keyword">private</span> String code;</div><div class="line">	<span class="keyword">private</span> String time;</div><div class="line">	<span class="keyword">private</span> String data;</div><div class="line">	</div><div class="line">	<span class="comment">//get、set方法省略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 设置数据传递的超时时间、建立连接的超时时间</div><div class="line">    */</div><div class="line">   SimpleClientHttpRequestFactory requestFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</div><div class="line">requestFactory.setReadTimeout(READTIMEOUT);</div><div class="line">   requestFactory.setConnectTimeout(CONNECTTIMEOUT);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 实例化一个RestTemplate对象</div><div class="line">    */</div><div class="line">RestTemplate restClient = <span class="keyword">new</span> RestTemplate();</div><div class="line">restClient.setRequestFactory(requestFactory);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 用ResponseResult对象封装响应结果</div><div class="line">    */</div><div class="line">String url = <span class="string">"http://localhost:8080/user/info/v5.6.5?id=3f62fca0123"</span>;</div><div class="line">ResponseResult result = restClient.getForObject(<span class="keyword">new</span> URI(url), ResponseResult.class);</div><div class="line">System.out.println(result.getMsg());</div></pre></td></tr></table></figure>
<blockquote>
<p>3.GET-调用对应的REST接口，在rest接口PATH路径中传递参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 请求参数在对应的请求path地址中</div><div class="line">    */</div><div class="line">String URI = <span class="string">"http://localhost:8080/user/info/&#123;id&#125;/v5.6.5"</span>;</div><div class="line">   RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</div><div class="line">   ResponseResult result = restTemplate.getForObject(URI, ResponseResult.class, <span class="string">"3f62fca0123"</span>);<span class="comment">//把请求接口中的&#123;id&#125;参数值放入最后一个入参中，最后一个参数是一个可变长(数组)类型的入参</span></div><div class="line">System.out.println(result.getMsg());</div></pre></td></tr></table></figure>
<blockquote>
<p>4.POST-调用对应的REST接口，设置header参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 设置header入参对象</div><div class="line">    */</div><div class="line">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</div><div class="line">   headers.set(<span class="string">"area"</span>, <span class="string">"010"</span>);</div><div class="line">   headers.set(<span class="string">"token"</span>, <span class="string">"71aee1b842cc49f69d26b4bd980c9b8d"</span>); </div><div class="line">headers.setAccept(Arrays.asList(MediaType.APPLICATION_JSON)); </div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 把对应的header对象通过HttpEntity进行封装处理</div><div class="line">    */</div><div class="line">RestTemplate restClient = <span class="keyword">new</span> RestTemplate();</div><div class="line">HttpEntity&lt;String&gt; httpEntity = <span class="keyword">new</span> HttpEntity&lt;String&gt;(headers);</div><div class="line"></div><div class="line">String postUrl = <span class="string">"http://localhost:8080/user/info/v5.6.5?id=3f62fca0123"</span>;</div><div class="line">ResponseEntity&lt;ResponseResult&gt; result = restClient.postForEntity(postUrl, httpEntity, ResponseResult.class);</div><div class="line"></div><div class="line">System.out.println(result.getBody().getMsg());</div></pre></td></tr></table></figure>
<blockquote>
<p>5.POST-调用rest接口时，传递json参数</p>
</blockquote>
<p><em>因为一般rest接口都是提供给其他系统调用的，如果一个rest接口的入参数量很多的时候，往往调用比较麻烦，并且容易出错；并且接口提供方一般在对应的rest接口入参中使用对象传参，方便后期接口扩展；所以针对接口调用方来讲，只需要按照入参的对象的属性名称封装一个json格式的数据串即可成功调用，这样一来兼容性会比较好</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 设置header入参对象</div><div class="line">    */</div><div class="line">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</div><div class="line">   headers.set(<span class="string">"token"</span>, <span class="string">"71aee1b842cc49f69d26b4bd980c9b8d"</span>); </div><div class="line">headers.setContentType(MediaType.APPLICATION_JSON);</div><div class="line"></div><div class="line">String postUrl = <span class="string">"http://localhost:8080/user/add/v5.6.5"</span>;	</div><div class="line">String requestJson = <span class="string">"&#123;\"name\":\"张三\",\"age\":25&#125;"</span>;<span class="comment">//这里可以用JSONObject处理json格式的入参，避免拼接字符串</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 把请求入参和对应的header入参封装到HttpEntity对象中</div><div class="line">    */</div><div class="line">HttpEntity&lt;String&gt; httpEntity = <span class="keyword">new</span> HttpEntity&lt;String&gt;(requestJson,headers);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">    * 请求对应的rest接口添加用户操作</div><div class="line">    */</div><div class="line">RestTemplate restClient = <span class="keyword">new</span> RestTemplate();</div><div class="line">String result = restClient.postForObject(postUrl, httpEntity, String.class);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/使用spring的RestTemplate调用REST接口时出现线程阻塞/" itemprop="url">
                  使用spring的RestTemplate调用REST接口时出现线程阻塞
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-18T16:32:12+08:00" content="2017-12-18">
              2017-12-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于需要给APP端提供相关的数据服务，所以在后台也少不了调用第三方平台的服务接口，所以开发接口调用时，我们后台一般使用spring的RestTemplate调用对应的REST接口获取数据；最近开发时，由于使用了MappingJackson2HttpMessageConverter转换器，所以导致接口性能压测时，出现了大量的线程BLOCKED：</p>
<p><img src="http://soujava.com/images/threadBlcked.png" alt="Alt text"></p>
<p>然后通过jstack命令把接口调用过程的线程情况进行了输出，然后根据输出的线程调用栈情况，逐级找到了最终的阻塞原因，整个过程如下：</p>
<blockquote>
<p>1.使用jstack命令输出java的堆栈信息如下：</p>
</blockquote>
<p><img src="http://soujava.com/images/dump.png" alt="Alt text"></p>
<blockquote>
<p>2.根据堆栈信息，逐级进入代码分析步骤如下：</p>
</blockquote>
<p><img src="http://soujava.com/images/threaddump.png" alt="Alt text"></p>
<ul>
<li>MappingJackson2HttpMessageConverter类的构造器方法如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">MappingJackson2HttpMessageConverter</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">this</span>(Jackson2ObjectMapperBuilder.json().build());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>点击build()方法如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> &lt;T extends ObjectMapper&gt; <span class="function">T <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">	ObjectMapper mapper;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.createXmlMapper) &#123;</div><div class="line">		mapper = (<span class="keyword">this</span>.defaultUseWrapper == <span class="keyword">null</span> ? <span class="keyword">new</span> XmlObjectMapperInitializer().create()</div><div class="line">				: <span class="keyword">new</span> XmlObjectMapperInitializer().create(<span class="keyword">this</span>.defaultUseWrapper));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		mapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line">	&#125;</div><div class="line">	configure(mapper); <span class="comment">//继续点击分析</span></div><div class="line">	<span class="keyword">return</span> (T) mapper;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>点击configure()方法如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</div><div class="line">	Assert.notNull(objectMapper, <span class="string">"ObjectMapper must not be null"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.findModulesViaServiceLoader) &#123;</div><div class="line">		<span class="comment">// Jackson 2.2+</span></div><div class="line">		objectMapper.registerModules(ObjectMapper.findModules(<span class="keyword">this</span>.moduleClassLoader));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.findWellKnownModules) &#123;</div><div class="line">		registerWellKnownModulesIfAvailable(objectMapper); <span class="comment">//继续点击深入分析</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.modules != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">for</span> (Module <span class="keyword">module</span> : <span class="keyword">this</span>.modules) &#123;</div><div class="line">			<span class="comment">// Using Jackson 2.0+ registerModule method, not Jackson 2.2+ registerModules</span></div><div class="line">			objectMapper.registerModule(<span class="keyword">module</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	....后半部分方法代码省略</div></pre></td></tr></table></figure>
<ul>
<li>点击进入registerWellKnownModulesIfAvailable()方法如下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerWellKnownModulesIfAvailable</span><span class="params">(ObjectMapper objectMapper)</span> </span>&#123;</div><div class="line"></div><div class="line">	  ....前半部分代码省略</div><div class="line"></div><div class="line">	<span class="comment">// Joda-Time present?</span></div><div class="line">	<span class="keyword">if</span> (ClassUtils.isPresent(<span class="string">"org.joda.time.LocalDate"</span>, <span class="keyword">this</span>.moduleClassLoader)) &#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">			<span class="comment">/**</span></div><div class="line">			 * 文件的根源就在这个ClassUtils.forName()方法底层中</div><div class="line">			 */</div><div class="line">			Class&lt;? extends Module&gt; jodaModule = (Class&lt;? extends Module&gt;)</div><div class="line">					ClassUtils.forName(<span class="string">"com.fasterxml.jackson.datatype.joda.JodaModule"</span>, <span class="keyword">this</span>.moduleClassLoader);</div><div class="line">			objectMapper.registerModule(BeanUtils.instantiate(jodaModule));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</div><div class="line">			<span class="comment">// jackson-datatype-joda not available</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	....后半部分代码省略</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>3.再继续按照整个堆栈信息，逐级向上找到最终的一个spring的java类中【ClassUtils.java:250】</p>
</blockquote>
<p><img src="http://soujava.com/images/dumpfenxi.png" alt="Alt text"></p>
<blockquote>
<p>4.然后进入org.springframework.util.ClassUtils.java类中的第250行</p>
</blockquote>
<p><img src="http://soujava.com/images/loadclass.png" alt="Alt text"></p>
<blockquote>
<p>5.我们点击loadClass()方法，进入到java.lang.ClassLoader.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">       <span class="keyword">return</span> loadClass(name, <span class="keyword">false</span>); <span class="comment">//该方法是另一个loadClass方法的重载</span></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>6.我们继续点击ClassLoader类中的loadClass()方法，进入到最底层的loadClass方法</p>
</blockquote>
<p><img src="http://soujava.com/images/loadclasslock.png" alt="Alt text"></p>
<p>通过方法我们可以看到该方法中以下两个导致线程阻塞的问题</p>
<ul>
<li>方法中有一个synchronized同步方法</li>
<li>同步方法中的getClassLoadingLock方法内部还有一个lock锁</li>
</ul>
<p>通过排查分析发现，就是上面的问题导致线程BLOCKED；后来去除了MappingJackson2HttpMessageConverter的注册，再次压测时，线程阻塞问题得以解决。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/前台向后台上传文件报net-ERR-CONNECTION-RESET问题入坑/" itemprop="url">
                  前台向后台上传文件报net::ERR_CONNECTION_RESET问题入坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-11T22:23:33+08:00" content="2017-12-11">
              2017-12-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>近期接手了一个备课系统的项目，该项目的特点是前后端分离的架构；前端(nodejs)-&gt;后台(java);今天在扩展新功能时，前端上传调用后台的rest接口上传文件时，有一个很诡异的问题，当上传的文件小于30M时，可以正常上传；当上传的文件大于30M时，在浏览器下面(F12)就会报出了net::ERR_CONNECTION_RESET的错误，错误信息如下图：</p>
<p><img src="http://soujava.com/images/bk.png" alt="Alt text"></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/前台向后台上传文件报net-ERR-CONNECTION-RESET问题入坑/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Linux服务器中查看log日志技巧/" itemprop="url">
                  Linux服务器中查看log日志技巧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-27T11:17:07+08:00" content="2017-09-27">
              2017-09-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>平时开发过程中，一般应用程序都会部署在linux操作系统上面，不管在什么阶段(开发、测试、线上)，难免会出现各种各样的问题，有些时候应该是bug，有些时候可能是偶然事件；不管出现什么问题，我们都需要找出问题所在，并且快速解决它；通常的做法无非是以下两种策略：</p>
<p><img src="http://soujava.com/images/log0.jpg" alt="Alt text"></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/Linux服务器中查看log日志技巧/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/最近开发app后台的一些小结/" itemprop="url">
                  最近开发app后台的一些小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-23T16:31:08+08:00" content="2017-09-23">
              2017-09-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/jersey/" itemprop="url" rel="index">
                    <span itemprop="name">jersey</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最近负责一个app产品后台的开发，主要包括app所有rest数据接口层的开发、第三方接口数据的融合过滤、第三方应用的接入(比如IM聊天、群组、电话虚拟拨号等等)、系统后台的管理配置等等，通过这个app后台的开发，也踩过不少坑，挖过不少雷，下面主要做一下小结：</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/最近开发app后台的一些小结/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/jersey-4-轻量级Rest接口服务开发之对象入参/" itemprop="url">
                  jersey-4--轻量级Rest接口服务开发之对象入参
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-11T10:35:29+08:00" content="2017-08-11">
              2017-08-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/jersey/" itemprop="url" rel="index">
                    <span itemprop="name">jersey</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本篇文章我主要描述一下通过javax.ws框架开发rest服务接口时，复杂一点的入参操作，主要包括对象入参、集合入参等等</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/jersey-4-轻量级Rest接口服务开发之对象入参/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/jersey-3-轻量级Rest接口服务开发之入参/" itemprop="url">
                  jersey-3--轻量级Rest接口服务开发之入参
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-14T15:48:18+08:00" content="2017-07-14">
              2017-07-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/jersey/" itemprop="url" rel="index">
                    <span itemprop="name">jersey</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>本篇文章我主要描述一下通过javax.ws框架开发rest服务接口时，基本的入参操作，主要包括入参类型的全局设定和方法级别设定、参数的默认值等等。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/jersey-3-轻量级Rest接口服务开发之入参/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/jersey-2-轻量级Rest接口后台服务常规接口开发/" itemprop="url">
                  jersey-2--轻量级Rest接口后台服务常规接口开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-04T15:27:35+08:00" content="2017-07-04">
              2017-07-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/jersey/" itemprop="url" rel="index">
                    <span itemprop="name">jersey</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>随着上一篇文章讲解了jersey框架的搭建运行，这一篇主要围绕我们平时开发rest接口方式进行示例；平时开发rest接口时无非提供GET、POST、PUT、DELETE等等类型的方法，或者在header中传入一些验证参数，下面我们就以user为例，主要围绕user的增删改查行为进行开发对应的rest接口。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/jersey-2-轻量级Rest接口后台服务常规接口开发/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="马平升" />
          <p class="site-author-name" itemprop="name">马平升</p>
          <p class="site-description motion-element" itemprop="description">记录未知的，牢记已知的</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">76</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">马平升</span>
</div>

<div class="powered-by">
  <a class="theme-link" href="http://www.soujava.com">soujava</a>
</div>

<div class="theme-info">
  
  <a class="theme-link" href="https://github.com/mapingsheng">
    GitHub
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
